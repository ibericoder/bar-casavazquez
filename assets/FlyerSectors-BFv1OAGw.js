import{d as ye,r as s,i as D,o as he,a as ke,x,c as i,b as a,h as L,H as S,J as be,F as C,f as z,e as $,K as W,m as Z,n as j,t as v,g as u,L as q,_ as _e}from"./index-BeB32QCd.js";import{L as f}from"./leaflet-Pecd1ig-.js";const Se={class:"flyer-sectors"},Be={class:"map-wrapper"},Te={class:"control-panel"},we=["disabled"],Me={key:0,class:"team-selector"},xe=["value"],Le={class:"tracking-card"},Ce={class:"tracking-header"},Ie={key:0,class:"tracking-status error"},Ve={class:"tracking-actions"},Ae=["disabled"],Fe=["disabled"],ze={key:0,class:"history-stats"},$e={class:"sectors"},Pe={class:"card-header"},Ne={class:"title-group"},Oe={class:"badge"},Ue=["onUpdate:modelValue"],Ge={key:0,class:"team-info"},He={class:"field"},Ke=["onUpdate:modelValue"],Ee={key:1,class:"coords"},Je={class:"toggles"},De=["onUpdate:modelValue"],We=["checked","onChange"],R="cv-admin-sectors-v2",Q="cv-admin-active-team",X="cv-admin-history-",Ze=ye({__name:"FlyerSectors",setup(je){const Y=[51.962714,7.644085],I=["Team Casa","Team Flyer","Team Nacht"],V=s(null),p=s(null),P=s(null),N=s(null),c=s(te()),O=s([...I]),y=s(ae()),r=s(H(y.value)),d=s(r.value.length?r.value[r.value.length-1]:null),B=typeof window<"u"&&"geolocation"in navigator,h=s(!1),b=s(null),T=s(!0),_=s(null),ee=D(()=>B?b.value?`Fehler: ${b.value}`:h.value?"Tracking aktiv":"Tracking inaktiv":"Geolokalisierung nicht verfügbar"),U=D(()=>c.value.every(e=>!e.served));he(()=>{if(!V.value)return;const e=f.map(V.value,{center:Y,zoom:16,maxZoom:19});p.value=e,f.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap-Mitwirkende"}).addTo(e),P.value=f.layerGroup().addTo(e),N.value=f.layerGroup().addTo(e),G(!0),w(!0)}),ke(()=>{A(),p.value&&p.value.remove()}),x(c,e=>{const t=e.map(o=>({...o,servedBy:o.served?o.servedBy??y.value??null:null}));if(t.some((o,l)=>o.servedBy!==e[l].servedBy)){c.value=t;return}ne(t),G()},{deep:!0}),x(y,e=>{typeof window<"u"&&localStorage.setItem(Q,e),r.value=H(e),d.value=r.value.length?r.value[r.value.length-1]:null,w(!0)}),x(r,()=>{oe(),w()}),x(d,()=>{w()});function G(e=!1){const t=P.value,n=p.value;if(!t||!n)return;t.clearLayers();const o=[];c.value.forEach(l=>{if(!l.visible||l.coordinates.length<3)return;const k=l.served?fe(l.color,.65):l.color,g=l.served?.18:.45,m=f.polygon(l.coordinates,{color:l.color,weight:2,fillColor:k,fillOpacity:g,dashArray:l.served?"6 6":void 0}),J=`<span>${l.name}</span>${l.servedBy?`<small>${l.servedBy}</small>`:""}`,me=f.marker(m.getBounds().getCenter(),{icon:f.divIcon({className:"sector-label",html:J}),interactive:!1});t.addLayer(m),t.addLayer(me),e&&o.push(...l.coordinates)}),e&&o.length&&n.fitBounds(o,{padding:[20,20]})}function w(e=!1){const t=N.value,n=p.value;if(!t||!n)return;t.clearLayers();let o=null;if(r.value.length>1){const l=f.polyline(r.value,{color:"#f06595",weight:4,opacity:.8});t.addLayer(l),o=l.getBounds()}if(d.value){const l=f.circleMarker(d.value,{radius:8,color:"#ff6b6b",weight:2,fillColor:"#ffffff",fillOpacity:.9});t.addLayer(l),T.value&&n.setView(d.value,Math.max(n.getZoom(),17))}e&&(o?n.fitBounds(o.pad(.2)):d.value&&n.setView(d.value,17))}function te(){if(typeof window>"u")return M();const e=localStorage.getItem(R);if(!e)return M();try{const t=JSON.parse(e);return Array.isArray(t)&&t.every(le)?t:M()}catch{return M()}}function ne(e){typeof window>"u"||localStorage.setItem(R,JSON.stringify(e))}function ae(){return typeof window>"u"?I[0]:localStorage.getItem(Q)||I[0]}function H(e){if(typeof window>"u")return[];const t=localStorage.getItem(`${X}${e}`);if(!t)return[];try{const n=JSON.parse(t);return Array.isArray(n)?n.filter(K):[]}catch{return[]}}function oe(){if(typeof window>"u")return;const e=`${X}${y.value}`;localStorage.setItem(e,JSON.stringify(r.value))}function M(){return[{id:"N",name:"Nord-Sektor",color:"#FF6B6B",coordinates:[[51.9652,7.6402],[51.9668,7.6387],[51.9689,7.6395],[51.9709,7.642],[51.9722,7.6468],[51.9716,7.6524],[51.9695,7.6558],[51.9674,7.6564],[51.9657,7.6518],[51.965,7.6461],[51.965,7.6428]],visible:!0,served:!1,servedBy:null},{id:"E",name:"Ost-Sektor",color:"#339AF0",coordinates:[[51.965,7.6461],[51.9657,7.6518],[51.9674,7.6564],[51.9669,7.6605],[51.966,7.6624],[51.965,7.6635],[51.964,7.6639],[51.963,7.663],[51.962,7.661],[51.9612,7.6584],[51.9608,7.6542],[51.9616,7.6493],[51.9627,7.6466],[51.9636,7.6452]],visible:!0,served:!1,servedBy:null},{id:"S",name:"Süd-Sektor",color:"#FF922B",coordinates:[[51.9636,7.6452],[51.9627,7.6466],[51.9616,7.6493],[51.9608,7.6542],[51.9596,7.6556],[51.9586,7.6562],[51.9576,7.6565],[51.9567,7.6558],[51.9558,7.6539],[51.9554,7.6515],[51.9556,7.649],[51.9548,7.6462],[51.9572,7.6446],[51.9584,7.6409],[51.9605,7.6399],[51.962,7.6422]],visible:!0,served:!1,servedBy:null}]}function le(e){return typeof e=="object"&&e!==null&&typeof e.id=="string"&&typeof e.name=="string"&&typeof e.color=="string"&&Array.isArray(e.coordinates)&&e.coordinates.every(K)&&typeof e.visible=="boolean"&&typeof e.served=="boolean"}function K(e){return Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"}function re(){U.value||(c.value=c.value.map(e=>({...e,served:!1,servedBy:null})))}function se(){h.value?A():ie()}function ie(){!B||_.value!==null||(b.value=null,_.value=navigator.geolocation.watchPosition(ue,de,{enableHighAccuracy:!0,maximumAge:5e3,timeout:15e3}),h.value=!0)}function A(){_.value!==null&&typeof navigator<"u"&&(navigator.geolocation.clearWatch(_.value),_.value=null),h.value=!1}function ue(e){const t=[e.coords.latitude,e.coords.longitude],n=r.value.length?r.value[r.value.length-1]:null;d.value=t,(!n||ve(n,t)>=5)&&(r.value=[...r.value,t]),T.value&&p.value&&p.value.setView(t,Math.max(p.value.getZoom(),17))}function de(e){b.value=e.message,A()}function ce(){r.value=[],d.value=null}function ve([e,t],[n,o]){const k=(n-e)*Math.PI/180,g=(o-t)*Math.PI/180,m=Math.sin(k/2)*Math.sin(k/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2);return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}function fe(e,t){const n=pe(e),o=parseInt(n.slice(0,2),16),l=parseInt(n.slice(2,4),16),k=parseInt(n.slice(4,6),16),g=m=>Math.round(m+(255-m)*t);return`#${F(g(o))}${F(g(l))}${F(g(k))}`}function pe(e){const t=e.trim().replace("#","");return t.length===3?t.split("").map(n=>n+n).join(""):t.padEnd(6,"0").slice(0,6)}function F(e){return e.toString(16).padStart(2,"0")}function ge(e,t){const n=t.target,o=!!(n!=null&&n.checked);e.served=o,e.servedBy=o&&y.value||null,c.value=[...c.value]}function E(e){return e?`${e[0].toFixed(5)}, ${e[1].toFixed(5)}`:"—"}return(e,t)=>(u(),i("div",Se,[a("div",Be,[a("div",{ref_key:"mapContainer",ref:V,class:"map","aria-label":"Liefergebiets-Karte"},null,512)]),a("aside",Te,[a("header",null,[t[2]||(t[2]=a("h1",null,"Flyer-Sektoren",-1)),t[3]||(t[3]=a("p",null,"Plane Zustellungen, markiere erledigte Bereiche und verfolge dein Team live.",-1)),a("button",{type:"button",class:"reset",onClick:re,disabled:U.value}," Markierungen zurücksetzen ",8,we)]),O.value.length?(u(),i("div",Me,[t[4]||(t[4]=a("label",{for:"team-select"},"Team",-1)),S(a("select",{id:"team-select","onUpdate:modelValue":t[0]||(t[0]=n=>y.value=n)},[(u(!0),i(C,null,z(O.value,n=>(u(),i("option",{key:n,value:n},v(n),9,xe))),128))],512),[[be,y.value]])])):L("",!0),a("section",Le,[a("div",Ce,[t[6]||(t[6]=a("h2",null,"Live-Tracking",-1)),a("label",null,[S(a("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>T.value=n),type:"checkbox"},null,512),[[W,T.value]]),t[5]||(t[5]=$(" Karte folgt Team "))])]),Z(B)?(u(),i(C,{key:1},[a("p",{class:j(["tracking-status",{active:h.value,error:b.value}])},v(ee.value),3),a("div",Ve,[a("button",{type:"button",onClick:se,disabled:!Z(B)},v(h.value?"Tracking stoppen":"Tracking starten"),9,Ae),a("button",{type:"button",onClick:ce,disabled:r.value.length===0}," Verlauf löschen ",8,Fe)]),r.value.length?(u(),i("ul",ze,[a("li",null,"Letzte Position: "+v(E(d.value)),1),a("li",null,"Punkte im Verlauf: "+v(r.value.length),1)])):L("",!0)],64)):(u(),i("p",Ie," Dein Browser unterstützt keine Geolokalisierung. "))]),a("div",$e,[(u(!0),i(C,null,z(c.value,n=>(u(),i("section",{key:n.id,class:"sector-card"},[a("div",Pe,[a("div",Ne,[a("span",Oe,v(n.id),1),S(a("input",{"onUpdate:modelValue":o=>n.name=o,class:"name-input"},null,8,Ue),[[q,n.name]])]),a("span",{class:j(["status",{served:n.served}])},v(n.served?"Erledigt":"Offen"),3)]),t[11]||(t[11]=a("p",{class:"area-hint"},"Grenzen orientieren sich an Kreuzungen rund um die Warendorfer Straße.",-1)),n.servedBy?(u(),i("p",Ge,"Übernommen von "+v(n.servedBy),1)):L("",!0),a("div",He,[t[7]||(t[7]=a("label",null,"Farbe",-1)),S(a("input",{"onUpdate:modelValue":o=>n.color=o,type:"color"},null,8,Ke),[[q,n.color]])]),n.coordinates.length?(u(),i("details",Ee,[t[8]||(t[8]=a("summary",null,"Koordinaten anzeigen",-1)),a("ul",null,[(u(!0),i(C,null,z(n.coordinates,(o,l)=>(u(),i("li",{key:l},v(E(o)),1))),128))])])):L("",!0),a("div",Je,[a("label",null,[S(a("input",{"onUpdate:modelValue":o=>n.visible=o,type:"checkbox"},null,8,De),[[W,n.visible]]),t[9]||(t[9]=$(" Sichtbar "))]),a("label",null,[a("input",{checked:n.served,type:"checkbox",onChange:o=>ge(n,o)},null,40,We),t[10]||(t[10]=$(" Abgedeckt "))])])]))),128))])])]))}}),Qe=_e(Ze,[["__scopeId","data-v-f3624e89"]]);export{Qe as default};
